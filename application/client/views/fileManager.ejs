<% layout('./layout/core') %>

<section id="container">

    <section id="container" ng-controller="FileManagerController" ng-cloak>
        <section id="manager">
            <section id="manager-container" ng-class="{ preview: FileManager.previewActivated }">
                <section class="manager-bloc">
                    <section id="toolbar">
                        <section id="breadcrumb" class="pull-left google-font big-font" ng-controller="BreadcrumbController">
                            <span class="path-part" ng-repeat="(index, part) in Breadcrumb.path track by $index">
                                <span ng-if="index != Breadcrumb.path.length - 1" ng-click="Breadcrumb.load(index)">{{part}}</span>
                                <span ng-if="index == Breadcrumb.path.length - 1" class="active">{{part}}</span>
                            </span>
                        </section>
                        <section class="tb-container pull-right">
                            <article class="tb-option" ng-click="FileManager.refresh()">
                                <article class="tb-option-container">
                                    <article class="tb-icon"><i class="icon-refresh"></i></article>
                                </article>
                            </article>
                            <article class="tb-option">
                                <input type="file" class="input-file" />
                                <article class="tb-option-container" button-uploader ng-click="_buttonUploader.selectFile()">
                                    <article class="tb-icon"><i class="icon-cloud-upload"></i></article>
                                </article>
                            </article>
                            <article class="tb-option">
                                <article class="tb-option-container" ng-click="FileManager.download();">
                                    <article class="tb-icon"><i class="icon-cloud-download"></i></article>
                                </article>
                            </article>
                            <article class="tb-option">
                                <article class="tb-option-container" ng-click="FileManager.createFolder();">
                                    <article class="tb-icon"><i class="icon-folder"></i></article>
                                </article>
                            </article>
                            <article class="tb-option">
                                <article class="tb-option-container" ng-click="FileManager.delete();">
                                    <article class="tb-icon"><i class="icon-times"></i></article>
                                </article>
                            </article>
                            <article class="tb-option">
                                <article class="tb-option-container" ng-click="FileManager.rename();">
                                    <article class="tb-icon small"><i class="icon-pencil"></i></article>
                                </article>
                            </article>
                        </section>
                    </section>
                    <article class="manager-bloc-container">
                        <section id="list-file-container">
                            <article class="list-file">
                                <table class="listing">
                                    <thead>
                                        <tr class="list-header big-font google-font">
                                            <th class="item-label"></th>
                                            <th >Name</th>
                                            <th class="information type">Type</th>
                                            <th class="information owner">Owner</th>
                                            <th class="information size hidden-xs">size</th>
                                            <th class="information update hidden-xs">Last Update</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr id="{{item.getFullPath()}}" class="item item-file-manager big-font google-font" ng-class="{selected: _item.selected}" item item-id={{index}} ng-dblclick="_item.open();" ng-click="_item.select($event);" ng-right-click="_item.preview($event);" file-uploader file-path={{item.getPath()}} ng-repeat="(index, item) in FileManager.items" draggable="{{!_item.item.unselectable}}" dropzone="move">
                                            <td class="item-label" ng-class="_item.item.category"></td>
                                            <td ng-class="{bold: _item.item.category == 'folder'}" class="limit-text">
                                                <article>
                                                    <span ng-hide="_item.item.editMode">{{_item.item.name}}</span>
                                                    <article class="edit" ng-if="_item.item.editMode">
                                                        <input type="text" ng-model="_item.item.name" placeholder="{{_item.oldName}}" ng-keyup="_item.validEdit($event)" ng-auto-focus>
                                                        <i class="icon-check" ng-click="_item.validEdit();"></i>
                                                        <i class="icon-times" ng-click="_item.cancelEdit();"></i>
                                                    </article>
                                                </article>
                                            </td>
                                            <td class="information">{{_item.item.category}}</td>
                                            <td class="information">{{_item.item.owner}}</td>
                                            <td class="information hidden-xs">{{_item.item.size | ItemSizeFilter}}</td>
                                            <td class="information hidden-xs">{{_item.item.lastUpdate | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </article>
                        </section>
                    </article>
                </section>
                <section class="manager-bloc" ng-controller="PreviewController">
                    <article class="manager-bloc-container google-font preview-container" ng-if="FileManager.selectedItems.length == 1">
                        <section class="preview-infos">
                            <article class="share-icon"><i ng-class="{'icon-link': FileManager.selectedItems[0].category != 'folder', 'icon-group': FileManager.selectedItems[0].category == 'folder'}" ng-show="(FileManager.selectedItems[0].category != 'folder' && FileManager.selectedItems[0].shared) || (FileManager.selectedItems[0].category == 'folder')" ng-click="FileManager.unshareFile()"></i></article>
                            <article class="file-size">{{FileManager.selectedItems[0].size | ItemSizeFilter}}</article>
                            <article class="preview-name">{{FileManager.selectedItems[0].name}} <i class="icon-pencil"></i></article>
                        </section>
                        <%- include partials/ejs/component/preview.ejs %>
                        <section class="preview-share">
                            <button class="share-button" ng-click="FileManager.shareFile()">Partager</button>
                        </section>
                    </article>
                </section>
            </section>
        </section>

        <section class="md-modal md-effect-1" id="modal-sharing-file" ng-class="{'md-show': FileManager.urlSharing != null}" modal>
            <section class="md-content">
                <h3>Partage public</h3>
                <article>
                    <a ng-href="{{FileManager.urlSharing}}" target="_blank">{{FileManager.urlSharing}}</a>
                    <button class="md-close" ng-click="_modal.close()">Fermer</button>
                </article>
            </section>
        </section>

        <form-post-downloader></form-post-downloader>
    </section>
</section>
